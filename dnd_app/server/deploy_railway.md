# Деплой на Railway

Railway - это отличная платформа для бесплатного хостинга с PostgreSQL базой данных.

## Шаг 1: Подготовка

1. Убедитесь, что у вас есть аккаунт на GitHub
2. Зарегистрируйтесь на [Railway](https://railway.app/)
3. Подключите ваш GitHub аккаунт к Railway

## Шаг 2: Создание проекта

1. В Railway нажмите "New Project"
2. Выберите "Deploy from GitHub repo"
3. Найдите и выберите ваш репозиторий `dnd_app`
4. Railway автоматически определит, что это Python проект

## Шаг 3: Настройка базы данных

1. В вашем проекте нажмите "New"
2. Выберите "Database" → "PostgreSQL"
3. Railway создаст PostgreSQL базу данных
4. Скопируйте `DATABASE_URL` из настроек базы данных

## Шаг 4: Настройка переменных окружения

1. В настройках вашего веб-сервиса перейдите в "Variables"
2. Добавьте переменную:
   - `DATABASE_URL` = скопированный URL из PostgreSQL
   - `PORT` = 5000 (если нужно)

## Шаг 5: Настройка деплоя

1. В настройках веб-сервиса:
   - **Root Directory**: `server` (если сервер в папке server)
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `python app.py`

## Шаг 6: Деплой

1. Railway автоматически запустит деплой при подключении репозитория
2. Дождитесь завершения сборки
3. Проверьте логи на наличие ошибок

## Шаг 7: Инициализация базы данных

После успешного деплоя:

1. Откройте консоль Railway (Railway CLI или веб-консоль)
2. Выполните команду:
```bash
python init_db.py
```

Или используйте API endpoint:
```bash
curl -X POST https://your-app-name.railway.app/api/load-data
```

## Шаг 8: Проверка работы

1. Откройте URL вашего приложения
2. Проверьте health endpoint: `https://your-app-name.railway.app/api/health`
3. Проверьте API: `https://your-app-name.railway.app/api/spells`

## Шаг 9: Обновление iOS приложения

1. Откройте `dnd_app/SpellsStoreAPI.swift`
2. Замените `baseURL` на ваш Railway URL:
```swift
private let baseURL = "https://your-app-name.railway.app/api"
```

## Возможные проблемы

### Ошибка импорта модулей
Убедитесь, что `requirements.txt` содержит все необходимые зависимости.

### Ошибка подключения к базе данных
Проверьте, что `DATABASE_URL` правильно настроен и база данных создана.

### Ошибка загрузки JSON файлов
Убедитесь, что файлы `spells.json` и `feats.json` находятся в правильной папке.

### CORS ошибки
CORS уже настроен в коде, но если проблемы остаются, проверьте настройки в Railway.

## Мониторинг

Railway предоставляет:
- Логи в реальном времени
- Метрики использования
- Мониторинг состояния приложения

## Обновления

При каждом push в GitHub Railway автоматически пересоберет и перезапустит приложение.

## Лимиты бесплатного плана

- 500 часов работы в месяц
- 1 ГБ RAM
- 1 ГБ дискового пространства
- PostgreSQL с ограничениями

Этого достаточно для небольшого D&D приложения.
